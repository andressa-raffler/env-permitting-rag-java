databaseChangeLog:
  - changeSet:
      id: 0005-seed-sample
      author: andressa
      comments: "Small seed to validate retrieval end-to-end (safe to delete)"
      changes:
        - insert:
            schemaName: ${schemaName}
            tableName: document_source
            columns:
              - column: {name: id, valueComputed: "gen_random_uuid()"}
              - column: {name: uri, value: "file://data/docs/sample.pdf#p=1"}
              - column: {name: title, value: "Sample Environmental Rule"}
              - column: {name: version, value: "v1"}
              - column: {name: tags, value: "{}"}
        - sql:
            splitStatements: false
            sql: |
              INSERT INTO ${schemaName}.document_chunk (id, doc_id, chunk_index, text, metadata, embedding)
              SELECT gen_random_uuid(), ds.id, 0,
                     'For operating permits, the following documents are required: ...',
                     '{"section":"Requirements","uf":"SP"}'::jsonb,
                     ('[' || array_to_string(ARRAY(SELECT 0.0 FROM generate_series(1, ${embeddingDims})), ',') || ']')::vector
              FROM ${schemaName}.document_source ds
              WHERE ds.title = 'Sample Environmental Rule' LIMIT 1;
      rollback:
        - delete:
            schemaName: ${schemaName}
            tableName: document_chunk
            where: "chunk_index = 0"
        - delete:
            schemaName: ${schemaName}
            tableName: document_source
            where: "title = 'Sample Environmental Rule'"
